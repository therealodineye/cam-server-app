services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: mediamtx-app
    restart: unless-stopped
    ports:
      - "18554:8554" # RTSP
    volumes:
      - ./config/mediamtx.yaml:/mediamtx.yaml

  ffmpeg-manager:
    build:
      context: ./ffmpeg_manager
    container_name: ffmpeg_manager
    restart: unless-stopped
    depends_on:
      - mediamtx
      
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    volumes:
      - ./config/cameras.yaml:/config/cameras.yaml:ro
    ports:
      - "18890:8080"
